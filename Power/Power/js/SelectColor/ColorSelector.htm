<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>颜色选择框</title>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <style type="text/css">
        TD
        {
            font-size: 9pt;
        }
        BODY
        {
            font-size: 10.8pt;
        }
        .button
        {
            font-size: 12px;
            width: 5em;
        }
        A
        {
            color: blue;
        }
    </style>

    <script language="JavaScript" type="text/javascript">
        var SelRGB = '';
        var DrRGB = '';
        var SelGRAY = '120';
        var ShowColor = null;
        var RGB = null;
        var GRAY = null;
        var SelColor = null;

        var hexch = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F');

        function GetShowColor() {
            if (ShowColor == null) {
                ShowColor = document.getElementById("ShowColor");
            }
            return ShowColor;
        }

        function GetRGB() {
            if (RGB == null) {
                RGB = document.getElementById("RGB");
            }
            return RGB;
        }

        function GetGRAY() {
            if (GRAY == null) {
                GRAY = document.getElementById("GRAY");
            }
            return GRAY;
        }

        function GetSelColor() {
            if (SelColor == null) {
                SelColor = document.getElementById("SelColor");
            }
            return SelColor;
        }

        function GetEventTarget(event) {
            if (event.target) {
                return event.target;
            }
            else {
                return event.srcElement;
            }
        }

        // initColor() function added by Macro Zeng
        // 2006-7-26   http://www.hbcms.com
        function initColor() {
            if (location.search != '' && location.search != '?') {
                var old_color = location.search.substr(1);
                if (/^[0-9A-Fa-f]{6}$/.test(old_color)) {
                    SelRGB = '#' + old_color;
                    GetRGB().innerHTML = SelRGB;
                    EndColor();
                } else {
                    GetSelColor().value = old_color;
                    GetShowColor().style["backgroundColor"] = GetSelColor().value;
                }
            }
        }

        function ToHex(n) {
            var h, l;

            n = Math.round(n);
            l = n % 16;
            h = Math.floor((n / 16)) % 16;
            return (hexch[h] + hexch[l]);
        }

        function DoColor(c, l) {
            var r, g, b;

            r = '0x' + c.substring(1, 3);
            g = '0x' + c.substring(3, 5);
            b = '0x' + c.substring(5, 7);

            if (l > 120) {
                l = l - 120;

                r = (r * (120 - l) + 255 * l) / 120;
                g = (g * (120 - l) + 255 * l) / 120;
                b = (b * (120 - l) + 255 * l) / 120;
            } else {
                r = (r * l) / 120;
                g = (g * l) / 120;
                b = (b * l) / 120;
            }

            return '#' + ToHex(r) + ToHex(g) + ToHex(b);
        }

        function EndColor() {
            var i;

            if (DrRGB != SelRGB) {
                DrRGB = SelRGB;
                for (i = 0; i <= 30; i++)
                    document.getElementById("GrayTable").rows[i].bgColor = DoColor(SelRGB, 240 - i * 8);
            }

            if (GetRGB().innerHTML == '') {
                initColor();
            } else {
                GetSelColor().value = DoColor(GetRGB().innerHTML, GetGRAY().innerHTML);
                GetShowColor().style["backgroundColor"] = GetSelColor().value;
            }
        }

        function ColorTableMouseOver(event) {
            GetRGB().innerHTML = GetEventTarget(event).bgColor;
            EndColor();
        }

        function ColorTableMouseOut(event) {
            GetRGB().innerHTML = SelRGB;
            EndColor();
        }

        function ColorTableClick(event) {
            SelRGB = GetEventTarget(event).bgColor;
            EndColor();
        }

        function ColorTableDBLclick(event) {
            window.returnValue = GetSelColor().value;
            window.close();
        }

        function GrayTableClick(event) {
            SelGRAY = GetEventTarget(event).title;
            EndColor();
        }

        function GrayTableMouseOver(event) {
            GetGRAY().innerHTML = GetEventTarget(event).title;
            EndColor();
        }

        function GrayTableMouseOut(event) {
            GetGRAY().innerHTML = SelGRAY;
            EndColor();
        }

        function OkClick() {
            window.returnValue = GetSelColor().value;
            window.close();
        }
    </script>
</head>
<body style="overflow: hidden; background-color:#EEEEEE">
    <span id="hbcms_select_color">
        <div align="center">
            <center>
                <table cellspacing="10" cellpadding="0" border="0">
                    <tr>
                        <td>
                            <table id="ColorTable" style="cursor: hand" cellspacing="0" cellpadding="0" border="0" onmouseover="ColorTableMouseOver(event);" onmouseout="ColorTableMouseOut(event)" onclick="ColorTableClick(event)" ondblclick="ColorTableDBLclick(event)">
                                <script language="JavaScript" type="text/javascript">
                                    function wc(r, g, b, n) {
                                        r = ((r * 16 + r) * 3 * (15 - n) + 0x80 * n) / 15;
                                        g = ((g * 16 + g) * 3 * (15 - n) + 0x80 * n) / 15;
                                        b = ((b * 16 + b) * 3 * (15 - n) + 0x80 * n) / 15;

                                        document.write('<TD BGCOLOR=#' + ToHex(r) + ToHex(g) + ToHex(b) + ' height=8 width=8></TD>');
                                    }

                                    var cnum = new Array(1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0);

                                    for (i = 0; i < 16; i++) {
                                        document.write('<TR>');
                                        for (j = 0; j < 30; j++) {
                                            n1 = j % 5;
                                            n2 = Math.floor(j / 5) * 3;
                                            n3 = n2 + 3;
                                            wc((cnum[n3] * n1 + cnum[n2] * (5 - n1)), (cnum[n3 + 1] * n1 + cnum[n2 + 1] * (5 - n1)), (cnum[n3 + 2] * n1 + cnum[n2 + 2] * (5 - n1)), i);
                                        }
                                        document.writeln('</TR>');
                                    }
                                </script>
                            </table>
                        </td>
                        <td>
                            <table id="GrayTable" style="cursor: hand" cellspacing="0" cellpadding="0" border="0" onmouseover="GrayTableMouseOver(event);" onmouseout="GrayTableMouseOut(event)" onclick="GrayTableClick(event)">
                                <script language="JavaScript"  type="text/javascript">
                                    for (i = 255; i >= 0; i -= 8.5)
                                        document.write('<TR BGCOLOR=#' + ToHex(i) + ToHex(i) + ToHex(i) + '><TD TITLE=' + Math.floor(i * 16 / 17) + ' height=4 width=20></TD></TR>');
                                </script>
                            </table>
                        </td>
                    </tr>
                </table>
            </center>
        </div>
        <div align="center">
            <center>
                <table cellspacing="10" cellpadding="0" border="0" >
                    <tbody>
                        <tr>
                            <td align="middle" rowspan="2">
                                选中色彩
                                <div id="ShowColor" style="height:30px; width:50px;"></div>                                
                                <input type="button" style="font-size: 9pt; width: 50px; height: 20px" onfocus="blur();" onclick="initColor();" value="恢复"/>
                            </td>
                            <td rowspan="2"style="vertical-align:top">
                                基色: <span id="RGB" style="width:20px"></span>
                                <br/>
                                亮度: <span id="GRAY">120</span>
                                <br/>
                                <br/>
                                代码:
                                <input id="SelColor" style="font-size: 9pt; height: 20px" size="7" type="text" />
                            </td>
                            <td>
                                <input type="button" onclick="OkClick();" value="确定" class="button" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="button" onclick="window.close();" value="取消" class="button" />
                            </td>
                        </tr>
                    </tbody>
                </table>
            </center>
        </div>
    </span>

    <script language="JavaScript" type="text/javascript">
        initColor();
    </script>

</body>
</html>
